---

- name: Init K8 cluster
  block:

  - name: check if kubeadm is startetd
    shell: netstat -np | grep 6443
    register: kubeInit
    ignore_errors: true

  - name: Initialize the Kubernetes cluster using kubeadm
    command: kubeadm init --apiserver-advertise-address="{{ ansible_facts.eth1.ipv4.address }}" --apiserver-cert-extra-sans="{{ ansible_facts.eth1.ipv4.address }}"  --node-name="{{ ansible_hostname }}" --pod-network-cidr="{{ podNetwork }}"
    when: kubeInit.rc !=0
    run_once: True
    
  become: yes
  become_user: root